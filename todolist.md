# 程序功能:

## 主菜单:
- [ ] 实现主菜单界面
- [ ] 添加“本地游戏”选项, 点击后进入创建本地游戏界面
- [ ] 添加“创建网络游戏”选项, 点击后以房主的身份进入创建网络游戏界面
- [ ] 添加“加入网络游戏”选项, 点击后进入加入网络游戏界面
- [ ] 添加“图鉴”选项, 点击后进入图鉴界面
- [ ] 添加“退出游戏”选项, 点击后退出游戏

## 创建本地游戏界面:
- [ ] 实现创建本地游戏界面
- [ ] 允许用户创建新游戏, 此时:
    - [ ] 允许选择游戏模式
    - [ ] 允许选择地图
- [ ] 也允许用户加载已有存档, 此时:
    - [ ] 显示可用存档列表
    - [ ] 允许选择存档并加载游戏
- [ ] 无论是创建新游戏还是加载存档, 允许设置各个玩家的名称和颜色, 以及是否为 AI 玩家(AI 玩家暂未实现)
- [ ] 添加“开始游戏”按钮, 点击后进入BP界面

## 创建网络游戏界面:
- [ ] 实现创建网络游戏界面
- [ ] 显示自动分配的房间号(随机数)
- [ ] 允许房主创建新网络游戏, 此时:
    - [ ] 允许选择游戏模式
    - [ ] 允许选择地图
- [ ] 也允许房主加载已有存档, 此时:
    - [ ] 显示可用存档列表
    - [ ] 允许选择存档并加载游戏
- [ ] 无论是创建新游戏还是加载存档, 允许设置玩家的名称和颜色, 以及是否为 AI 玩家(AI 玩家暂未实现), 但是各自玩家只允许设置自己的名称和颜色, 房主可以设置AI 玩家
- [ ] 允许玩家交换位置
- [ ] 如果有玩家加入或离开, 实时更新玩家列表
- [ ] 加入玩家过多或者将地图人数改小后, 多余玩家可以进入旁观模式
- [ ] 玩家也可以主动选择进入旁观模式, 但房主除外
- [ ] 添加“开始游戏”按钮, 点击后该玩家进入准备模式
- [ ] 所有玩家进入准备模式后, 进入BP界面

- 创建网络游戏界面和创建本地游戏界面的功能和布局大部分相同, 可以考虑复用代码

## 加入网络游戏界面:
- [ ] 实现加入网络游戏界面
- [ ] 允许用户输入房间号并加入网络游戏
- [ ] 如果房间不存在, 显示错误信息
- [ ] 加入成功后, 以参与者的身份进入创建网络游戏界面

## BP界面:
- [ ] 实现BP界面
- [ ] 首先, 所有玩家在逻辑上独立地进行ban, ban兵种/建筑/法术均可, 只有数量显示没有类型限制 (如果是本地游戏, 则依次ban, 但是看不见其他玩家的选择; 如果是网络游戏, 则各自独立ban)
- [ ] 显示所有被ban的兵种/建筑/法术, 然后所有玩家在逻辑上独立地进行pick, pick时对每种类型有各自的数量限制, 有些模式还需要在pick时设置优势兵种/优势建筑/优势法术 (如果是本地游戏, 则依次pick, 但是看不见其他玩家的选择; 如果是网络游戏, 则各自独立pick) (为提供丰富接口, "设置优势兵种"这种功能应该视为只是挂上了一个Tag, 方便其他模式对Tag的数量和内容进行扩展)
- [ ] 显示所有被pick的兵种/建筑/法术, 以及各自的优势兵种/优势建筑/优势法术
- [ ] 所有玩家pick完成后, 进入游戏界面

## 游戏界面:
- [ ] 实现游戏界面
- [ ] ui布局(从左至右):
    - [ ] 最左侧显示玩家信息(名称, 颜色, 资源, 选择的实体列表), 每名玩家一列
    - [ ] 中间偏左显示地图区域, 按需显示高亮, 逻辑见文档最后
    - [ ] 右上角显示当前回合数和选项菜单按钮
        - [ ] 选项菜单按钮点击后弹出菜单, 菜单选项包括: 快速保存游戏, 保存游戏, 退出到主菜单, 退出游戏
        - [ ] 点击“快速保存游戏”后, 直接保存当前游戏状态到临时存档
        - [ ] 点击“保存游戏”后, 弹出文件选择界面, 允许选择存档文件名并保存当前游戏状态
        - [ ] 点击“退出到主菜单”后, 询问玩家是否确认退出, 返回主菜单界面, 且当前游戏状态会被自动保存到临时存档
        - [ ] 点击“退出游戏”后, 询问玩家是否确认退出, 直接退出游戏程序, 且当前游戏状态会被自动保存到临时存档
    - [ ] 右侧中间偏上为状态栏, 显示当前选中实体的信息(名称, 生命值, 攻击力, 防御力, 技能列表等)
    - [ ] 右侧中间很窄的地方预留为被动技能发动的询问区域
    - [ ] 右侧下方显示操作日志, 显示最近的游戏事件和操作记录
    - [ ] 右侧最下方为结束回合按钮, 点击后结束当前玩家回合, 如果是联机游戏且未轮到自己, 则按钮不可点击

## 图鉴界面: 
- [ ] 实现图鉴界面接口, 具体内容待定

## 地图ui逻辑:

- [ ] 游戏按照回合进行, 联机模式时, 玩家执行完自己的回合之后才把这一回合的操作发送给其他玩家
- [ ] 联机模式未轮到自己, 或者旁观者视角时, ui和引擎不交互, 但是点击实体可以在状态栏查看其信息
- [ ] 每个角色的实体按照颜色区分玩家归属, 中立实体为黑色 
- [ ] 本地游戏或联机游戏轮到自己时:
    - [ ] 默认状态下, 地图显示的可行动的己方实体高亮显示. (注意"可行动"和"可操作"不等价, 比如建筑发动技能之后仍可以拆除) 
    - [ ] 默认状态下, 左键或右键点击己方实体时, 选中该实体, 在状态栏显示其信息, 如果可以移动, 在地图上高亮显示可移动范围; 如果可以攻击, 在地图上高亮显示可攻击目标; 在状态栏显示技能列表, 使用次数>0的技能可以点击使用, 如果是己方建筑, 则还要显示拆除按钮. 当鼠标悬停在高亮单元格上时, 更换高亮样式以提示可以进行操作.
    - [ ] 默认状态下, 左键或右键点击中立或敌方实体时, 在状态栏显示该实体的信息.
    - [ ] 默认状态下, 点击法术图标时, 询问是否使用该法术.
- [ ] 一些技能或者一些攻击需要选择固定大小的区域(比如公主的攻击, 炸弹塔的攻击, 法术的范围选择), 此时:
    - [ ] 鼠标悬停时, 显示以鼠标为中心的技能作用范围, 注意:
        - 此时可能会超出地图边界
        - 此时鼠标"最精确的位置"可能是单元格的边界或顶点, 此时需要智能判断以显示正确的范围
- [ ] 还有一些技能的选择区域非常奇葩, 需要特殊处理, 请预留函数接口, 比如:
    - 将鼠标位置和其他信息传入函数, 函数返回合法的选择区域和高亮显示方式
    - 更加奇葩的技能可以由技能函数和ui多轮交互, 由技能函数指导ui进行自定义高亮显示
- [ ] 有一些技能需要点击左侧玩家信息的选中的兵种, 建筑, 法术列表, 此时也应当正确返回给引擎.
- [ ] 除了默认状态下选择要操作的实体以外, 对于所有单位格(区域)的选择, 遵循:
    - 右键点击合法位置, 视为选择该位置操作
    - 右键点击不合法位置, 或者左键点击, 视为取消. 如果此状态可取消, 则向引擎发送取消, 否则保持当前状态不变.

## 保存游戏和载入游戏
- [ ] 仅实现接口, 具体内容待定

## 网络通信
- [ ] 仅实现接口, 具体内容待定

## 每个兵种/建筑/法术的技能函数
- [ ] 具体内容可以暂时不管